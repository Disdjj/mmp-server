{
  "openrpc": "1.2.6",
  "info": {
    "title": "Model-Memory-Protocol",
    "description": "一种用于AI模型记忆管理的开放协议，支持树形结构化记忆的存储和检索",
    "version": "1.0.0",
    "license": {
      "name": "MIT"
    },
    "contact": {
      "name": "MMP团队"
    }
  },
  "methods": [
    {
      "name": "memory.getInitNodes",
      "summary": "获取所有待初始化节点",
      "description": "返回指定记忆树中所有标记为需要初始化的记忆节点列表",
      "params": [
        {
          "name": "memoryId",
          "description": "目标记忆集合的ID",
          "required": true,
          "schema": {
            "type": "string",
            "description": "格式为mm-{uuid}"
          }
        },
        {
          "name": "filter",
          "description": "过滤条件",
          "required": false,
          "schema": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "路径前缀过滤"
              }
            }
          }
        }
      ],
      "result": {
        "name": "initNodesResult",
        "description": "待初始化节点列表",
        "schema": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "节点路径"
              },
              "name": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "attention": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    {
      "name": "memory.add",
      "summary": "添加记忆",
      "description": "向指定的记忆树中添加新的记忆节点",
      "params": [
        {
          "name": "memoryId",
          "description": "目标记忆集合的ID",
          "required": true,
          "schema": {
            "type": "string",
            "description": "格式为mm-{uuid}"
          }
        },
        {
          "name": "node",
          "description": "要添加的记忆节点",
          "required": true,
          "schema": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "节点名称"
              },
              "description": {
                "type": "string",
                "description": "节点描述"
              },
              "path": {
                "type": "string",
                "description": "节点路径，形如层级结构"
              },
              "attention": {
                "type": "string",
                "description": "特别说明"
              },
              "needInit": {
                "type": "boolean",
                "description": "是否需要初始化"
              },
              "format": {
                "type": "string",
                "description": "该节点下子节点的格式要求"
              },
              "type": {
                "type": "string",
                "enum": ["json", "markdown", "xml", "plaintext"],
                "description": "内容类型"
              },
              "content": {
                "type": "string",
                "description": "节点内容"
              }
            },
            "required": ["name", "path", "type", "content"]
          }
        }
      ],
      "result": {
        "name": "addResult",
        "description": "添加记忆节点的结果",
        "schema": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "成功添加的节点的完整路径"
            }
          }
        }
      }
    },
    {
      "name": "memory.get",
      "summary": "获取记忆",
      "description": "获取指定记忆树中特定路径节点的内容",
      "params": [
        {
          "name": "memoryId",
          "description": "目标记忆集合的ID",
          "required": true,
          "schema": {
            "type": "string",
            "description": "格式为mm-{uuid}"
          }
        },
        {
          "name": "path",
          "description": "要获取的记忆节点的路径",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "outputFormat",
          "description": "输出格式",
          "required": false,
          "schema": {
            "type": "string",
            "enum": ["xml", "json", "text"],
            "default": "text"
          }
        }
      ],
      "result": {
        "name": "getResult",
        "description": "获取记忆节点的结果",
        "schema": {
          "$ref": "#/components/schemas/MemoryNode"
        }
      }
    },
    {
      "name": "memory.list",
      "summary": "获取记忆列表",
      "description": "获取指定记忆树中符合条件的记忆节点列表",
      "params": [
        {
          "name": "memoryId",
          "description": "目标记忆集合的ID",
          "required": true,
          "schema": {
            "type": "string",
            "description": "格式为mm-{uuid}"
          }
        },
        {
          "name": "filter",
          "description": "过滤条件",
          "required": false,
          "schema": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "路径前缀过滤"
              },
              "type": {
                "type": "string",
                "description": "记忆类型过滤"
              },
              "needInit": {
                "type": "boolean",
                "description": "是否需要初始化"
              }
            }
          }
        },
        {
          "name": "pagination",
          "description": "分页参数",
          "required": false,
          "schema": {
            "type": "object",
            "properties": {
              "offset": {
                "type": "integer",
                "default": 0
              },
              "limit": {
                "type": "integer",
                "default": 50
              }
            }
          }
        }
      ],
      "result": {
        "name": "listResult",
        "description": "记忆节点列表结果",
        "schema": {
          "type": "object",
          "properties": {
            "total": {
              "type": "integer"
            },
            "nodes": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "节点路径"
                  },
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "memory.update",
      "summary": "更新记忆",
      "description": "更新指定记忆树中特定路径节点的内容",
      "params": [
        {
          "name": "memoryId",
          "description": "目标记忆集合的ID",
          "required": true,
          "schema": {
            "type": "string",
            "description": "格式为mm-{uuid}"
          }
        },
        {
          "name": "path",
          "description": "要更新的记忆节点的路径",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "updates",
          "description": "要更新的字段",
          "required": true,
          "schema": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "content": {
                "type": "string"
              },
              "attention": {
                "type": "string"
              },
              "format": {
                "type": "string"
              },
              "needInit": {
                "type": "boolean"
              }
            }
          }
        }
      ],
      "result": {
        "name": "updateResult",
        "description": "更新记忆节点的结果",
        "schema": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "成功更新的节点的路径"
            },
            "updatedAt": {
              "type": "string",
              "format": "date-time"
            }
          }
        }
      }
    },
    {
      "name": "memory.delete",
      "summary": "删除记忆",
      "description": "删除指定记忆树中特定路径的记忆节点",
      "params": [
        {
          "name": "memoryId",
          "description": "目标记忆集合的ID",
          "required": true,
          "schema": {
            "type": "string",
            "description": "格式为mm-{uuid}"
          }
        },
        {
          "name": "path",
          "description": "要删除的记忆节点的路径",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "recursive",
          "description": "是否递归删除子节点",
          "required": false,
          "schema": {
            "type": "boolean",
            "default": false
          }
        }
      ],
      "result": {
        "name": "deleteResult",
        "description": "删除记忆节点的结果",
        "schema": {
          "type": "object",
          "properties": {
            "success": {
              "type": "boolean"
            },
            "deletedCount": {
              "type": "integer"
            }
          }
        }
      }
    },
    {
      "name": "memManager.create",
      "summary": "创建新的记忆树ID",
      "description": "创建一个新的记忆树ID（memoryId），并提供名称和描述",
      "params": [
        {
          "name": "name",
          "description": "记忆集合的名称",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "description",
          "description": "记忆集合的简短描述",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "metadata",
          "description": "记忆集合的元数据",
          "required": false,
          "schema": {
            "type": "object"
          }
        }
      ],
      "result": {
        "name": "createMemoryResult",
        "description": "创建记忆ID的结果",
        "schema": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string",
              "description": "新创建的记忆ID，格式为mm-{uuid}"
            },
            "name": {
              "type": "string"
            },
            "description": {
              "type": "string"
            },
            "createdAt": {
              "type": "string",
              "format": "date-time"
            }
          }
        }
      }
    },
    {
      "name": "memManager.applyTemplate",
      "summary": "为记忆ID应用模板",
      "description": "为指定的记忆ID（memoryId）应用一组记忆节点模板",
      "params": [
        {
          "name": "memoryId",
          "description": "目标记忆集合的ID",
          "required": true,
          "schema": {
            "type": "string",
            "description": "格式为mm-{uuid}"
          }
        },
        {
          "name": "template",
          "description": "要应用的记忆节点模板列表",
          "required": true,
          "schema": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "节点名称"
                },
                "description": {
                  "type": "string",
                  "description": "节点描述"
                },
                "path": {
                  "type": "string",
                  "description": "节点路径"
                },
                "attention": {
                  "type": "string",
                  "description": "特别说明"
                },
                "needInit": {
                  "type": "boolean",
                  "description": "是否需要初始化，如为true则content不允许为空"
                },
                "format": {
                  "type": "string",
                  "description": "格式要求"
                },
                "type": {
                  "type": "string",
                  "enum": ["json", "markdown", "xml", "plaintext"],
                  "description": "内容类型"
                },
                "content": {
                  "type": "string",
                  "description": "节点内容，若needInit为true则不能为空"
                }
              },
              "required": ["name", "path", "type", "needInit"]
            }
          }
        }
      ],
      "result": {
        "name": "applyTemplateResult",
        "description": "为记忆ID应用模板的结果",
        "schema": {
          "type": "object",
          "properties": {
            "memoryId": {
              "type": "string"
            },
            "success": {
              "type": "boolean"
            },
            "createdNodes": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "创建的节点路径"
                  },
                  "needInit": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "name": "memory.batch",
      "description": "批量的获取记忆节点 (Batch retrieve memory nodes)",
      "params": [
        {
          "name": "requests",
          "description": "一个包含多个获取请求的数组，每个请求指定要获取的记忆节点 (An array of retrieval requests, each specifying a memory node to retrieve)",
          "required": true,
          "schema": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "memoryId": {
                  "description": "记忆ID (Memory ID)",
                  "type": "string",
                  "pattern": "^mm-[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
                },
                "path": {
                  "description": "记忆节点的路径 (Path of the memory node)",
                  "type": "string"
                }
              },
              "required": [
                "memoryId",
                "path"
              ]
            }
          }
        }
      ],
      "result": {
        "name": "batchResult",
        "description": "一个包含对应请求结果的数组，每个结果是一个记忆节点或错误信息 (An array containing the results for each corresponding request, each result being a memory node or an error)",
        "schema": {
          "type": "array",
          "items": {
            "$ref": "#/components/schemas/MemoryNode"
          }
        }
      },
      "tags": [
        {
          "name": "Memory"
        }
      ]
    }
  ],
  "components": {
    "schemas": {
      "Memory": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "记忆ID，格式为mm-{uuid}"
          },
          "name": {
            "type": "string",
            "description": "记忆集合名称"
          },
          "description": {
            "type": "string",
            "description": "记忆集合的简短描述"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        },
        "required": ["id", "name", "description"]
      },
      "MemoryNode": {
        "type": "object",
        "description": "表示记忆树中的一个节点",
        "properties": {
          "path": {
            "type": "string",
            "description": "节点在记忆树中的唯一路径，相对于memoryId"
          },
          "name": {
            "type": "string",
            "description": "节点名称"
          },
          "description": {
            "type": "string",
            "description": "节点描述"
          },
          "attention": {
            "type": "string",
            "description": "特别说明"
          },
          "needInit": {
            "type": "boolean",
            "description": "是否需要初始化"
          },
          "format": {
            "type": "string",
            "description": "格式要求"
          },
          "type": {
            "type": "string",
            "enum": ["json", "markdown", "xml", "plaintext"],
            "description": "内容类型"
          },
          "content": {
            "type": "string",
            "description": "节点内容"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "创建时间"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "更新时间"
          }
        },
        "required": ["path", "name", "type"]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object"
          }
        },
        "required": ["code", "message"]
      },
      "MemoryTemplate": {
        "type": "object",
        "properties": {
          "nodes": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/MemoryNode"
            },
            "description": "模板中的记忆节点列表"
          }
        },
        "required": ["nodes"]
      }
    },
    "contentDescriptors": {
      "JsonRpcRequest": {
        "name": "request",
        "description": "JSON-RPC 2.0请求对象",
        "schema": {
          "type": "object",
          "properties": {
            "jsonrpc": {
              "type": "string",
              "enum": ["2.0"]
            },
            "id": {
              "type": "string"
            },
            "method": {
              "type": "string"
            },
            "params": {
              "type": "object"
            }
          },
          "required": ["jsonrpc", "id", "method"]
        }
      },
      "JsonRpcResponse": {
        "name": "response",
        "description": "JSON-RPC 2.0响应对象",
        "schema": {
          "type": "object",
          "properties": {
            "jsonrpc": {
              "type": "string",
              "enum": ["2.0"]
            },
            "id": {
              "type": "string"
            },
            "result": {
              "type": "object"
            },
            "error": {
              "$ref": "#/components/schemas/ErrorResponse"
            }
          },
          "required": ["jsonrpc", "id"]
        }
      }
    },
    "errors": [
      {
        "code": -32700,
        "message": "解析错误",
        "description": "无效的JSON"
      },
      {
        "code": -32600,
        "message": "无效请求",
        "description": "请求对象不符合规范"
      },
      {
        "code": -32601,
        "message": "方法不存在",
        "description": "请求的方法不存在"
      },
      {
        "code": -32602,
        "message": "无效参数",
        "description": "无效的方法参数"
      },
      {
        "code": -32603,
        "message": "内部错误",
        "description": "内部JSON-RPC错误"
      },
      {
        "code": 10001,
        "message": "节点不存在",
        "description": "请求的记忆节点路径不存在"
      },
      {
        "code": 10002,
        "message": "路径已存在",
        "description": "尝试创建的节点路径已存在"
      },
      {
        "code": 10003,
        "message": "模板不存在",
        "description": "请求的记忆模板不存在"
      },
      {
        "code": 10004,
        "message": "模板格式无效",
        "description": "提供的模板格式不正确，当needInit为true时content不能为空"
      },
      {
        "code": 10005,
        "message": "记忆ID不存在",
        "description": "指定的记忆ID不存在"
      }
    ]
  }
}
